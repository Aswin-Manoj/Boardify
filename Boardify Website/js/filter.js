games = [
  {
    "uid": 0,
    "title": "Chess",
    "path": "resources/chess.webp",
    "age": 5,
    "genre": [
      "Strategy",
      "Tactics"
    ],
    "players": [
      2,
      2
    ],
    "duration": [
      10,
      60
    ],
    "ratings": 4.2,
    "difficulty": 5,
    "favourite": false,
    "desc": "Chess is a two-player, abstract strategy board game that represents medieval warfare on an 8x8 board with alternating light and dark squares. Opposing pieces, traditionally designated White and Black, are initially lined up on either side. Each type of piece has a unique form of movement and capturing occurs when a piece, via its movement, occupies the square of an opposing piece. Players take turns moving one of their pieces in an attempt to capture, attack, defend, or develop their positions. Chess games can end in checkmate, resignation, or one of several types of draws.",
    "yt_link": "https://www.youtube.com/embed/OCSbzArwB10"
  },
  {
    "uid": 1,
    "title": "The Settlers of Catan",
    "path": "resources/catan.webp",
    "age": 10,
    "genre": [
      "Strategy",
      "Eurogames",
      "Negotiation"
    ],
    "players": [
      3,
      4
    ],
    "duration": [
      60,
      90
    ],
    "ratings": 4.7,
    "difficulty": 3,
    "favourite": false,
    "desc": "In CATAN (formerly The Settlers of Catan), players try to be the dominant force on the island of Catan by building settlements, cities, and roads. On each turn dice are rolled to determine what resources the island produces. Players build by spending resources (sheep, wheat, wood, brick and ore) that are depicted by these resource cards; each land type, with the exception of the unproductive desert, produces a specific resource: hills produce brick, forests produce wood, mountains produce ore, fields produce wheat, and pastures produce sheep. lorem ipsum ingoa adakdjnajdand dnabfjkfjkdsnfhen edhfheqbdkjef",
    "yt_link": "https://www.youtube.com/embed/cPhX_1RiwEg"
  },
  {
    "uid": 2,
    "title": "Ticket to Ride",
    "path": "resources/ticket_to_ride.webp",
    "age": 8,
    "genre": [
      "Strategy"
    ],
    "players": [
      2,
      5
    ],
    "duration": [
      30,
      60
    ],
    "ratings": 4.5,
    "difficulty": 2,
    "favourite": false,
    "desc": "With elegantly simple gameplay, Ticket to Ride can be learned in under 15 minutes. Players collect cards of various types of train cars they then use to claim railway routes in North America. The longer the routes, the more points they earn. Additional points come to those who fulfill Destination Tickets – goal cards that connect distant cities; and to the player who builds the longest continuous route.",
    "yt_link": "https://www.youtube.com/embed/4JhFhyvGdik"
  },
  {
    "uid": 3,
    "title": "Pandemic",
    "path": "resources/pandemic.webp",
    "age": 13,
    "genre": [
      "Co-op"
    ],
    "players": [
      2,
      4
    ],
    "duration": [
      45,
      60
    ],
    "ratings": 4.8,
    "difficulty": 4,
    "favourite": false,
    "desc": "In Pandemic, several virulent diseases have broken out simultaneously all over the world! The players are disease-fighting specialists whose mission is to treat disease hotspots while researching cures for each of four plagues before they get out of hand.",
    "yt_link": "https://www.youtube.com/embed/ojkScPkdgsk"
  },
  {
    "uid": 4,
    "title": "Codenames",
    "path": "resources/codenames.webp",
    "age": 14,
    "genre": [
      "Party Games"
    ],
    "players": [
      4,
      8
    ],
    "duration": [
      15,
      30
    ],
    "ratings": 4.6,
    "difficulty": 2,
    "favourite": false,
    "desc": "Two rival spymasters know the secret identities of 25 agents. Their teammates know the agents only by their codenames — single-word labels like disease, Germany, and carrot.Yes, carrot. It's a legitimate codename. Each spymaster wants their team to identify their agents first...without uncovering the assassin by mistake.In Codenames, two teams compete to see who can make contact with all of their agents first.",
    "yt_link": "https://www.youtube.com/embed/WErB95Brgbs"
  },
  {
    "uid": 5,
    "title": "Scrabble",
    "path": "resources/scrabble.webp",
    "age": 8,
    "genre": [
      "Word"
    ],
    "players": [
      2,
      4
    ],
    "duration": [
      30,
      60
    ],
    "ratings": 4.0,
    "difficulty": 2,
    "favourite": false,
    "desc": "In this classic word game, players use their seven drawn letter-tiles to form words on the gameboard. Each word laid out earns points based on the commonality of the letters used, with certain board spaces giving bonuses. But a word can only be played if it uses at least one already-played tile or adds to an already-played word. This leads to slightly tactical play, as potential words are rejected because they would give an opponent too much access to the better bonus spaces.",
    "yt_link": "https://www.youtube.com/embed/dSXSYwBBTFs"
  },
  {
    "uid": 6,
    "title": "Risk",
    "path": "resources/risk.webp",
    "age": 10,
    "genre": [
      "Strategy"
    ],
    "players": [
      2,
      6
    ],
    "duration": [
      120,
      180
    ],
    "ratings": 3.9,
    "difficulty": 4,
    "favourite": false,
    "desc": "Risk is a global domination strategy game where players deploy armies, engage in battles, and vie for control of territories on a world map. The game involves negotiation, alliances, and strategic decision-making as players aim to eliminate opponents and achieve world domination.",
    "yt_link": "https://www.youtube.com/embed/NHQylg9oFwA"
  },
  {
    "uid": 7,
    "title": "Carcassonne",
    "path": "resources/carcassonne.webp",
    "age": 7,
    "genre": [
      "Tile-Laying"
    ],
    "players": [
      2,
      5
    ],
    "duration": [
      30,
      45
    ],
    "ratings": 4.4,
    "difficulty": 2,
    "favourite": false,
    "desc": "Carcassonne is a tile-placement game in which the players draw and place a tile with a piece of southern French landscape on it. The tile might feature a city, a road, a cloister, grassland or some combination thereof, and it must be placed adjacent to tiles that have already been played, in such a way that cities are connected to cities, roads to roads, etcetera. Having placed a tile, the player can then decide to place one of their meeples on one of the areas on it: on the city as a knight, on the road as a robber, on a cloister as a monk, or on the grass as a farmer. When that area is complete, that meeple scores points for its owner.",
    "yt_link": "https://www.youtube.com/embed/-74FYj21JVg"
  },
  {
    "uid": 8,
    "title": "Dixit",
    "path": "resources/dixit.webp",
    "age": 8,
    "genre": [
      "Party Games"
    ],
    "players": [
      3,
      6
    ],
    "duration": [
      30,
      45
    ],
    "ratings": 4.3,
    "difficulty": 1,
    "favourite": false,
    "desc": "Dixit is an imaginative party game where players use beautifully illustrated cards to create stories or descriptions. The goal is to provide clues that others will understand, without being too obvious or obscure. Players then vote on which card they believe matches the storyteller's description, adding a layer of deduction and creativity.",
    "yt_link": "https://www.youtube.com/embed/Qi4MoW6NuaQ"
  },
  {
    "uid": 9,
    "title": "Splendor",
    "path": "resources/splendor.webp",
    "age": 10,
    "genre": [
      "Strategy"
    ],
    "players": [
      2,
      4
    ],
    "duration": [
      30,
      45
    ],
    "ratings": 4.5,
    "difficulty": 2,
    "favourite": false,
    "desc": "Splendor is a game of chip-collecting and card development. Players are merchants of the Renaissance trying to buy gem mines, means of transportation, shops—all in order to acquire the most prestige points. If you're wealthy enough, you might even receive a visit from a noble at some point, which of course will further increase your prestige.",
    "yt_link": "https://www.youtube.com/embed/rue8-jvbc9I"
  },
  {
    "uid": 10,
    "title": "Azul",
    "path": "resources/azul.webp",
    "age": 8,
    "genre": [
      "Abstract"
    ],
    "players": [
      2,
      4
    ],
    "duration": [
      30,
      45
    ],
    "ratings": 4.4,
    "difficulty": 2,
    "favourite": false,
    "desc": "Introduced by the Moors, azulejos (originally white and blue ceramic tiles) were fully embraced by the Portuguese when their king Manuel I, on a visit to the Alhambra palace in Southern Spain, was mesmerized by the stunning beauty of the Moorish decorative tiles. The king, awestruck by the interior beauty of the Alhambra, immediately ordered that his own palace in Portugal be decorated with similar wall tiles. As a tile-laying artist, you have been challenged to embellish the walls of the Royal Palace of Evora.In the game Azul, players take turns drafting colored tiles from suppliers to their player board. Later in the round, players score points based on how they've placed their tiles to decorate the palace. Extra points are scored for specific patterns and completing sets; wasted supplies harm the player's score. The player with the most points at the end of the game wins.",
    "yt_link": "https://www.youtube.com/embed/dXuucWGrFMQ"
  },
  {
    "uid": 11,
    "title": "Love Letter",
    "path": "resources/love_letter.webp",
    "age": 10,
    "genre": [
      "Deduction"
    ],
    "players": [
      2,
      4
    ],
    "duration": [
      15,
      20
    ],
    "ratings": 4.2,
    "difficulty": 1,
    "favourite": false,
    "desc": "Love Letter is a game of risk, deduction, and luck for 2–4 players. Your goal is to get your love letter into Princess Annette's hands while deflecting the letters from competing suitors. From a deck with only sixteen cards, each player starts with only one card in hand; one card is removed from play. On a turn, you draw one card, and play one card, trying to expose others and knock them from the game. Powerful cards lead to early gains, but make you a target. Rely on weaker cards for too long, however, and your letter may be tossed in the fire!",
    "yt_link": "https://www.youtube.com/embed/WAiI7G3QdOU"
  },
  {
    "uid": 12,
    "title": "King of Tokyo",
    "path": "resources/king_of_tokyo.webp",
    "age": 8,
    "genre": [
      "Dice-Rolling"
    ],
    "players": [
      2,
      6
    ],
    "duration": [
      30,
      45
    ],
    "ratings": 4.6,
    "difficulty": 2,
    "favourite": false,
    "desc": "King of Tokyo is a fast-paced dice-rolling game where players control giant monsters vying for control of Tokyo. The objective is to either accumulate victory points or eliminate other monsters in the quest for dominance. The game's accessible mechanics and player interaction make it a lively and entertaining experience.",
    "yt_link": "https://www.youtube.com/embed/RWYGlPf6IzE"
  },
  {
    "uid": 13,
    "title": "Forbidden Island",
    "path": "resources/forbidden_island.webp",
    "age": 10,
    "genre": [
      "Co-op"
    ],
    "players": [
      2,
      4
    ],
    "duration": [
      30,
      45
    ],
    "ratings": 4.3,
    "difficulty": 3,
    "favourite": false,
    "desc": "Forbidden Island is a visually stunning cooperative board game. Instead of winning by competing with other players like most games, everyone must work together to win the game. Players take turns moving their pawns around the 'island', which is built by arranging the many beautifully screen-printed tiles before play begins. As the game progresses, more and more island tiles sink, becoming unavailable, and the pace increases. Players use strategies to keep the island from sinking, while trying to collect treasures and items. As the water level rises, it gets more difficult- sacrifices must be made.",
    "yt_link": "https://www.youtube.com/embed/S2GCP55_FOc"
  },
  {
    "uid": 14,
    "title": "7 Wonders",
    "path": "resources/seven_wonders.webp",
    "age": 10,
    "genre": [
      "Cards"
    ],
    "players": [
      3,
      7
    ],
    "duration": [
      30,
      45
    ],
    "ratings": 4.5,
    "difficulty": 2,
    "favourite": false,
    "desc": "7 Wonders is a card drafting and civilization-building game where players develop their cities over three ages. The goal is to accumulate points through strategic card choices, wonders, and interactions with neighboring civilizations. The simultaneous gameplay and diverse strategies contribute to its replayability.",
    "yt_link": "https://www.youtube.com/embed/XnBLz61FJYw"
  },
  {
    "uid": 15,
    "title": "Dominion",
    "path": "resources/dominion.webp",
    "age": 13,
    "genre": [
      "Cards"
    ],
    "players": [
      2,
      4
    ],
    "duration": [
      30,
      45
    ],
    "ratings": 4.4,
    "difficulty": 3,
    "favourite": false,
    "desc": "Dominion is a deck-building game where players start with a small deck of basic cards and gradually acquire new cards to enhance their decks. The goal is to accumulate victory points through card combinations and strategic deck management. The game's modular setup and varied card options offer replayability and depth.",
    "yt_link": "https://www.youtube.com/embed/5jNGpgdMums"
  },
  {
    "uid": 16,
    "title": "Hanabi",
    "path": "resources/hanabi.webp",
    "age": 8,
    "genre": [
      "Co-op"
    ],
    "players": [
      2,
      5
    ],
    "duration": [
      25,
      30
    ],
    "ratings": 4.2,
    "difficulty": 2,
    "favourite": false,
    "desc": "Hanabi is a cooperative card game where players work together to create a beautiful fireworks display. The catch is that players can't see their own cards and must rely on teammates' clues to play the right cards in the correct order. The unique communication aspect and limited information create a challenging and engaging experience.",
    "yt_link": "https://www.youtube.com/embed/d_js_3S_7K8"
  },
  {
    "uid": 17,
    "title": "Small World",
    "path": "resources/small_world.webp",
    "age": 8,
    "genre": [
      "Area Control"
    ],
    "players": [
      2,
      5
    ],
    "duration": [
      40,
      80
    ],
    "ratings": 4.1,
    "difficulty": 3,
    "favourite": false,
    "desc": "Small World is a fantasy-themed area control game where players lead various races and special powers to conquer regions on a modular board. The game features a dynamic decline mechanic, forcing players to adapt and choose new combinations strategically. The ever-changing landscape makes each game unique.",
    "yt_link": "https://www.youtube.com/embed/ibzqvd3b1Yg"
  },
  {
    "uid": 18,
    "title": "Agricola",
    "path": "resources/agricola.webp",
    "age": 12,
    "genre": [
      "Tactics"
    ],
    "players": [
      1,
      4
    ],
    "duration": [
      30,
      150
    ],
    "ratings": 4.5,
    "difficulty": 4,
    "favourite": false,
    "desc": "Agricola is a complex strategy game where players build and manage a farm, focusing on resource management, animal breeding, and expanding their homestead. Balancing these elements is crucial for success, and the game offers depth through its varied occupations and improvements.",
    "yt_link": "https://www.youtube.com/embed/LWuUuxbMDB0"
  },
  {
    "uid": 19,
    "title": "Forbidden Desert",
    "path": "resources/forbidden_desert.webp",
    "age": 10,
    "genre": [
      "Co-op"
    ],
    "players": [
      2,
      5
    ],
    "duration": [
      45,
      60
    ],
    "ratings": 4.3,
    "difficulty": 3,
    "favourite": false,
    "desc": "Gear up for a thrilling adventure to recover a legendary flying machine buried deep in the ruins of an ancient desert city. You'll need to coordinate with your teammates and use every available resource if you hope to survive the scorching heat and relentless sandstorm. Find the flying machine and escape before you all become permanent artifacts of the forbidden desert!.In Forbidden Desert, a thematic sequel to Forbidden Island, players take on the roles of brave adventurers who must throw caution to the wind and survive both blistering heat and blustering sand in order to recover a legendary flying machine buried under an ancient desert city. While featuring co-operative gameplay similar to Forbidden Island, Forbidden Desert is a fresh, new game based around an innovative set of mechanisms such as an ever-shifting board, individual resource management, and a unique method for locating the flying machine parts.",
    "yt_link": "https://www.youtube.com/embed/nq3DEdpo1d0"
  },
  {
    "uid": 20,
    "title": "Dominant Species",
    "path": "resources/dominant_species.webp",
    "age": 14,
    "genre": [
      "Strategy"
    ],
    "players": [
      2,
      6
    ],
    "duration": [
      120,
      240
    ],
    "ratings": 4.8,
    "difficulty": 4,
    "favourite": false,
    "desc": "Dominant Species is a game that abstractly recreates a tiny portion of ancient history: the ponderous encroachment of an ice age and what that entails for the living creatures trying to adapt to the slowly-changing earth.Each player will assume the role of one of six major animal classes—mammal, reptile, bird, amphibian, arachnid, or insect. Each begins the game more or less in a state of natural balance in relation to one another. But that won’t last: It is indeed survival of the fittest.",
    "yt_link": "https://www.youtube.com/embed/cKo4tX2nDso"
  }
];

const randomReviews = [
  {
    "madeBy": "Bob",
    "content": "Great game!",
    "rating": 5
  },
  {
    "madeBy": "Alice",
    "content": "Great game!",
    "rating": 4
  },
  {
    "madeBy": "Bob",
    "content": "Great game!",
    "rating": 5
  },
  {
    "madeBy": "Alice",
    "content": "Great game!",
    "rating": 4
  },
  {
    "madeBy": "Bob",
    "content": "Great game!",
    "rating": 5
  },
  {
    "madeBy": "Alice",
    "content": "Great game!",
    "rating": 4
  },
  {
    "madeBy": "Bob",
    "content": "Great game!",
    "rating": 5
  },
  {
    "madeBy": "Alice",
    "content": "Great game!",
    "rating": 4
  },
  {
    "madeBy": "Bob",
    "content": "Great game!",
    "rating": 5
  },
  {
    "madeBy": "Linus",
    "content": "This sucks...... Boooo\nDon't waste your time on this!",
    "rating": 2
  },
  {
    "madeBy": "Richard",
    "content": "Not RMS approved!",
    "rating": 1
  },
  {
    "madeBy": "John Doe",
    "content": "My friends love the game, tho I kept losing :(",
    "rating": 3
  },
]

gameReviews = {}

function getRandomElements(array, numElements) {
  if (numElements >= array.length) {
    return array;
  }

  const shuffledArray = array.slice();
  for (let i = shuffledArray.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [shuffledArray[i], shuffledArray[j]] = [shuffledArray[j], shuffledArray[i]];
  }

  return shuffledArray.slice(0, numElements);
}

function initGameReviews() {
  games.forEach(g => {
    gameReviews[g.uid] = getRandomElements(randomReviews, 5);
  })
}
initGameReviews();

const genreFilterItems = document.getElementById('genreFilters');
const listOfGenres = [...new Set(games.reduce((acc, game) => {
  acc.push(...game.genre);
  return acc;
}, []))];

function populateGenreFilter() {
  genreFilterItems.innerHTML = '';
  const allGenre = document.createElement('li');
  allGenre.innerHTML = `
        <div class="form-check">
            <input class="genreRadio" type="radio" name="genreSelect" value=0 id="genreAll" checked>
            <label class="genreName" for="genreAll">Show All</label>
        </div>
    `;
  genreFilterItems.appendChild(allGenre);
  document.getElementById("genreAll").addEventListener('change', renderGameCatalog);

  listOfGenres.forEach(g => {
    const genreItem = document.createElement('li');
    genreItem.innerHTML = `
            <div class="form-check">
                <input class="genreRadio" type="radio" name="genreSelect" value="${g}" id="filter${g}">
                <label class="genreName" for="filter${g}">${g}</label>
            </div>
        `;
    genreFilterItems.appendChild(genreItem);
    document.getElementById("filter" + g).addEventListener('change', renderGameCatalog);
  });
}
populateGenreFilter();

const gameCatalog = document.getElementById('main');

// const genreCheckbox = document.querySelectorAll('.genreCheckbox');
const genreFilter = document.querySelectorAll('.genreRadio');
const playersFilter = document.querySelectorAll('.playersRadio');
const rateFilter = document.querySelectorAll('.rateRadio');
const ageFilter = document.querySelectorAll('.ageRadio');
const durationFilter = document.querySelectorAll('.durationRadio');
const searchBar = document.getElementById('searchBarInput');
const searchButton = document.getElementById('searchBarButton');

const customPlayersInput = document.getElementById('playersFilter4');
const playersInput = document.getElementById('playersInput');

const genreHint = document.getElementById('genreHint');
const playersHint = document.getElementById('playersHint');
const rateHint = document.getElementById('rateHint');
const ageHint = document.getElementById('ageHint');
const durationHint = document.getElementById('durationHint');
const listHint = document.getElementById('listHeader');

const favouriteButton = document.getElementById('favouriteListButton');
const applyButton = document.getElementById('applyButton');
const sortButton = document.getElementById('sortByButton');
const sortOrderButton = document.getElementById('sortOrderButton');
const infoButton = document.getElementById('info-button');
const resetButton = document.getElementById('resetButton');

const createNewGameCard = function (game) {
  game.ratings = (gameReviews[game.uid].reduce((sum, review) => sum + review.rating, 0)) / gameReviews[game.uid].length;
  game.ratings = Math.round(game.ratings * (10 ** 2)) / (10 ** 2);

  const gameCard = document.createElement('div');
  gameCard.classList.add('cards');

  const gameImage = document.createElement('img');
  gameImage.src = game.path;
  gameImage.alt = Image;

  const gameFlex = document.createElement('div');
  gameFlex.classList.add('flex-container');

  const gameTitle = document.createElement('div');
  gameTitle.innerText = game.title;
  gameTitle.classList.add('flex-header');

  const infoButton = document.createElement('button');
  infoButton.setAttribute('type', 'button');
  infoButton.setAttribute('id', `${game.title}-info-button`);
  infoButton.setAttribute('data-bs-toggle', 'modal');
  infoButton.setAttribute('data-bs-target', `#model${game.uid}`);
  infoButton.classList.add('info-button');

  const iconElement = document.createElement('i');
  iconElement.classList.add('fa-solid', 'fa-circle-info');
  infoButton.appendChild(iconElement);

  const ageInfo = document.createElement('div');
  ageInfo.innerText = `Age: ${game.age}+`;
  ageInfo.classList.add('flex-item');

  const timeInfo = document.createElement('div');
  timeInfo.innerText = `Time: ${game.duration[0]} - ${game.duration[1]} mins`;
  timeInfo.classList.add('flex-item');

  const playerInfo = document.createElement('div');
  playerInfo.innerText = `Players: ${game.players[0]}${game.players[1] === game.players[0] ? '' : ' - ' + game.players[1]}`;
  playerInfo.classList.add('flex-item');

  const genreInfo = document.createElement('div');
  genreInfo.innerText = `Genre: ${game.genre[0]}`;
  genreInfo.classList.add('flex-item');

  const diffInfo = document.createElement('div');
  diffInfo.innerText = `Difficulty: ${game.difficulty}`;
  diffInfo.classList.add('flex-item');

  const rateInfo = document.createElement('div');
  rateInfo.innerText = `Ratings: ${game.ratings}/5  ★`;
  rateInfo.classList.add('flex-item');

  const likeButton = document.createElement('button');
  likeButton.setAttribute('type', 'button');
  likeButton.setAttribute('id', `like${game.uid}`);
  likeButton.classList.add('like-button');

  const heartIcon = document.createElement('i');
  heartIcon.classList.add(`fa-${game.favourite ? 'solid' : 'regular'}`, 'fa-heart', 'fa-2xl');
  infoButton.setAttribute('id', `heart${game.uid}`);
  likeButton.appendChild(heartIcon);

  likeButton.addEventListener('click', function () {
    game.favourite = !game.favourite;
    const heartIcon = likeButton.querySelector('.fa-heart');
    heartIcon.classList.toggle('fa-solid', game.favourite);
    heartIcon.classList.toggle('fa-regular', !game.favourite);
  })

  gameFlex.append(gameTitle, infoButton, ageInfo, timeInfo, playerInfo, genreInfo, diffInfo, rateInfo);

  gameCard.append(gameImage, gameFlex, likeButton);

  return gameCard;
};

const createReviewCard = function (review) {
  const reviewCard = document.createElement('div');
  reviewCard.classList.add('card', 'review-card');

  const userIcon = document.createElement('img');
  // userIcon.classList.add('card-img-top', 'img-thumbnail', 'avatar');
  // userIcon.alt = 'User Avatar 1';
  // userIcon.src = '/resources/avatar.jpeg';

  const cardBody = document.createElement('div');
  cardBody.classList.add('card-body');

  const reviewHeader = document.createElement('h5');
  reviewHeader.classList.add('card-title');
  reviewHeader.innerText = `${review.madeBy} ${review.rating}/5★ `;

  const reviewContent = document.createElement('p');
  reviewContent.classList.add('card-text');
  reviewContent.innerText = review.content;

  cardBody.append(reviewHeader, reviewContent);
  reviewCard.append(userIcon, cardBody);

  return reviewCard;
}

const createReviewSection = function (game) {
  const reviewRows = document.createElement('div');
  reviewRows.classList.add('row', 'bg');

  const reviewCols = document.createElement('div');
  reviewCols.classList.add('col');

  const reviewSection = document.createElement('section');
  reviewSection.classList.add('container', 'mt-1');

  const sectionHeader = document.createElement('h4');
  sectionHeader.classList.add('?> -center', 'mb-2');
  sectionHeader.innerText = 'Reviews';

  const cardsContainer = document.createElement('div');
  cardsContainer.classList.add('reviews-container', 'overflow-auto');
  cardsContainer.setAttribute('id', `reviews${game.uid}`);

  const leaveReview = document.createElement('div');
  leaveReview.classList.add('forum');
  leaveReview.innerHTML = `
        <ul id="reviews-list"></ul>
        <div class="add-review">
            <div class="dropdown">
                <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="true">
                    <label id="reviewRateLabel${game.uid}">Rate</label>
                </button>
                <ul class="dropdown-menu">
                    <li>
                        <div class="form-check">
                            <input class="reviewRadio${game.uid}" type="radio" name="review${game.uid}Ratings" id="review${game.uid}Ratings0"
                                onclick="updateRateHint(${game.uid})" value=0 checked>
                            <label class="rateLevel" for="review${game.uid}Ratings0">☆☆☆☆☆</label>
                        </div>
                    </li>
                    <li>
                        <div class="form-check">
                            <input class="reviewRadio${game.uid}" type="radio" name="review${game.uid}Ratings" value=1
                                onclick="updateRateHint(${game.uid})" id="review${game.uid}Ratings1">
                            <label class="rateLevel" for="review${game.uid}Ratings1">★☆☆☆☆</label>
                        </div>
                    </li>
                    <li>
                        <div class="form-check">
                            <input class="reviewRadio${game.uid}" type="radio" name="review${game.uid}Ratings" value=2
                                onclick="updateRateHint(${game.uid})" id="review${game.uid}Ratings2">
                            <label class="rateLevel" for="review${game.uid}Ratings2">★★☆☆☆</label>
                        </div>
                    </li>
                    <li>
                        <div class="form-check">
                            <input class="reviewRadio${game.uid}" type="radio" name="review${game.uid}Ratings" value=3
                                onclick="updateRateHint(${game.uid})" id="review${game.uid}Ratings3">
                            <label class="rateLevel" for="review${game.uid}Ratings3">★★★☆☆</label>
                        </div>
                    </li>
                    <li>
                        <div class="form-check">
                            <input class="reviewRadio${game.uid}" type="radio" name="review${game.uid}Ratings" value=4
                                onclick="updateRateHint(${game.uid})" id="review${game.uid}Ratings4">
                            <label class="rateLevel" for="review${game.uid}Ratings4">★★★★☆</label>
                        </div>
                    </li>
                    <li>
                        <div class="form-check">
                            <input class="reviewRadio${game.uid}" type="radio" name="review${game.uid}Ratings" value=5
                                onclick="updateRateHint(${game.uid})" id="review${game.uid}Ratings5">
                            <label class="rateLevel" for="review${game.uid}Ratings4">★★★★★</label>
                        </div>
                    </li>
                </ul>
            </div>
            <input type="text" class="review-name" id="name${game.uid}" placeholder="Name">
            <input type="text" class="review-content" id="content${game.uid}" placeholder="Review">
            <button  class="btn btn-secondary"type="button" onclick="addReview(${game.uid})")">Add Review</button>
        </div>
    `;

  const reviewStyleSheet = document.createElement('style');
  reviewStyleSheet.innerText = `
        .reviews-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
            height: 450px;
            overflow-y: scroll;
            position: relative;
            padding-bottom: 40px;   
          }
        .review-card {
            width: 80%;
            height: 140px;
            margin: 10px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .avatar {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            object-fit: cover;
        }
    `;

  cardsContainer.append(leaveReview);
  gameReviews[game.uid].forEach(r => {
    const reviewCard = createReviewCard(r);
    cardsContainer.appendChild(reviewCard);
  });

  reviewSection.append(sectionHeader, cardsContainer);
  reviewCols.append(reviewSection, reviewStyleSheet);
  reviewRows.appendChild(reviewCols);

  return reviewRows;
};

const createGameInfoPage = function (game) {
  const infoPage = document.createElement('div');
  infoPage.classList.add('modal', 'fade');
  infoPage.setAttribute('id', `model${game.uid}`);
  infoPage.setAttribute('tabindex', '-1');
  infoPage.setAttribute('aria-labelledby', `mlabel${game.uid}`);
  infoPage.setAttribute('aria-hidden', 'true');

  const scrollableDialog = document.createElement('div');
  scrollableDialog.classList.add('modal-dialog', 'modal-dialog-scrollable', 'modal-lg');

  const pageContent = document.createElement('div');
  pageContent.classList.add('modal-content');

  pageContent.innerHTML = `<div class="modal-header">
      <h5 class="modal-title">${game.title}</h5>
      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
    </div>`;
  // const pageHeader = document.createElement('div');
  // pageContent.classList.add('modal-header');

  // const headerContent = document.createElement('h1');
  // headerContent.classList.add('modal-title', 'fs-4');
  // headerContent.setAttribute('id', `mlabel${game.uid}`);
  // headerContent.innerText = `${game.title}`;

  // const closeButton = document.createElement('button');
  // closeButton.classList.add('btn-close');
  // closeButton.setAttribute('type', 'button');
  // closeButton.setAttribute('data-bs-dismiss', 'modal');
  // closeButton.setAttribute('aria-label', 'Close');

  const gameInfo = document.createElement('div');
  gameInfo.classList.add('container');

  const gameInfoRow = document.createElement('div');
  gameInfoRow.classList.add('row','mt-3');

  const gameImage = document.createElement('div');
  gameImage.classList.add('col-6', 'embed-responsive', 'embed-responsive-4by3');
  gameImage.innerHTML = `<iframe class="embed-responsive-item" src="${game.yt_link};"></iframe>`;
  // gammeImage.innerHTML = `<iframe class="embed-responsive-item" src="..."></iframe>`


  const gameDesc = document.createElement('div');
  gameDesc.classList.add('col-6', 'game-text', 'overflow-auto');
  // console.log(game.desc);
  gameDesc.innerText = `${game.desc}`;

  const actionArea = document.createElement('div');
  actionArea.classList.add('row', 'mb-1', 'mt-4');

  const buyButton = document.createElement('div');
  buyButton.classList.add('col', 'd-flex' ,'justify-content-center');
  buyButton.innerHTML = '<button type="button" class="btn btn-secondary">Buy</button>';

  const reviewsContainer = createReviewSection(game);

  actionArea.append(buyButton);
  gameInfoRow.append(gameImage, gameDesc);
  gameInfo.append(gameInfoRow, actionArea, reviewsContainer);
  // pageHeader.append(headerContent);
  pageContent.append(gameInfo);
  scrollableDialog.appendChild(pageContent);
  infoPage.appendChild(scrollableDialog);
  return infoPage;
};

function updateRateHint(gameID) {
  const reviewRateHint = document.getElementById(`reviewRateLabel${gameID}`);
  const reviewRateRadio = document.querySelectorAll(`.reviewRadio${gameID}`);
  const selectedRating = Array.from(reviewRateRadio).find(rateRadio => rateRadio.checked);
  reviewRateRadio.forEach(radio => {
    radio.addEventListener('change', function () {
      reviewRateHint.innerText =
        selectedRating.value == 5 ?
          '★★★★★' :
          selectedRating.value == 4 ?
            '★★★★☆' :
            selectedRating.value == 3 ?
              '★★★☆☆' :
              selectedRating.value == 2 ?
                '★★☆☆☆' :
                selectedRating.value == 1 ?
                  '★☆☆☆☆' : '☆☆☆☆☆';
    });
  });
}

function updatePageStyles() {
  page = document.getElementById('page');
  windowHeight = window.innerHeight;
  windowWidth = window.innerWidth;

  headerText = document.getElementById('listHeader');
  // fp = '10px';
  // fs = '20px';
  // if (windowHeight < 600 || windowWidth < 600) {
  fs = 6 + (windowWidth + windowHeight)/200 + 'px';
  fp = (windowWidth + windowHeight)/200 + 'px';
  // }

  headerText.style.fontSize = fs;

  flexHeaders = document.querySelectorAll('.flex-header');
  flexHeaders.forEach(h => {
    h.style.fontSize = 6 + (windowWidth + windowHeight)/180 + 'px';
    // h.style.width - windowWidth < 1200 ?
    // 'calc(80% - 180px)' : (windowWidth < 600 ?
    //   'calc(0% - 10px)' : 'calc(100% - 200px)')
  });

  infoButtons = document.querySelectorAll('.info-button');
  infoButtons.forEach(i => {
    i.style.fontSize = 10 + (windowWidth + windowHeight)/200 + 'px';
  })

  favBtn = document.getElementById('favouriteListButtonLabal');
  favBtn.innerHTML = windowWidth < 1200 ?
  '<i class="fa-solid fa-heart fa-xl"></i>' : 'My Favourites <span></span><i class="fa-solid fa-heart fa-xl"></i>'

  sortBtn = document.getElementById('sordOrderButtonLabel');
  sortBtn.innerHTML = windowWidth < 1200 ?
  '<i class="fa-solid fa-arrow-up-wide-short"></i>' : 'Sort By Difficulty';

  // filterSide = document.getElementById('filter-side');
  // filterSide.style.display = windowWidth < 1200 ?
  // 'none' : 'block';

  reviewSect = document.querySelectorAll('.reviews-container');
  reviewSect.forEach(r => {
    r.style.height = windowHeight > 800 ?
    windowHeight/2 + 'px':
    windowHeight/3 + 'px';
  });

  reviewNames = document.querySelectorAll('.review-name');
  reviewNames.forEach(n => {
    n.style.width = windowWidth*0.1+'px';
    n.style.height = '38px';
  });

  reviewText = document.querySelectorAll('.review-content');
  reviewText.forEach(n => {
    n.style.width = windowWidth*0.2+'px';
    n.style.height = '38px';
  });


  headerList = document.querySelector('.header-list');

  gapVar = 100;
  if (windowWidth < 1350) {
    gapVar = 150;
  } else if (windowWidth < 600) {
    gapVar = 300;
  }

  headerList.style.gap = (windowWidth + windowHeight)/gapVar + 'em';


  filterItems = document.querySelectorAll('.filter-item');
  filterBtns = document.querySelectorAll('.btns-filter');
  filterHr = document.querySelectorAll('.filter-hr');
  filterItems.forEach(f => {
    f.style.padding = fp;
    f.style.marginBottom = fp;
    f.style.marginTop = fp;
  });
  filterBtns.forEach(f => {
    f.style.padding = fp;
    f.style.marginBottom = fp;
    f.style.marginTop = fp;
  });
  filterHr.forEach(f => {
    f.style.display = windowHeight < 800 ? 'none':'block';
  });

  gameCards = document.querySelectorAll('.flex-item');
  gameCards.forEach(c => {
    c.style.fontSize = fs;
    c.style.flexBasis = windowWidth < 1200 ?
      'calc(50% - 10px)' :
      'calc(30% - 20px)';
  });

  page.style.height = windowHeight - 20 + 'px';
}

function renderGameCatalog() {
  // const selectedGenres = Array.from(genreCheckbox).filter(checkbox => checkbox.checked).map(checkbox => checkbox.value);
  const selectedGenre = Array.from(genreFilter).find(genreRadio => genreRadio.checked);
  const selectedPlayers = Array.from(playersFilter).find(playersRadio => playersRadio.checked);
  const selectedRating = Array.from(rateFilter).find(rateRadio => rateRadio.checked);
  const selectedAge = Array.from(ageFilter).find(ageRadio => ageRadio.checked);
  const selectedDuration = Array.from(durationFilter).find(durationRadio => durationRadio.checked);

  genreHint.innerHTML =
    selectedGenre.value == 0 ?
      '' :
      `${selectedGenre.value}
            <button class="small-reset-button" onclick="resetGenre()"><i class="fa-solid fa-xmark"></i></button>`;
  playersHint.innerHTML =
    customPlayersInput.checked ?
      `${playersInput.value}
        <button class="small-reset-button" onclick="resetPlayers()"><i class="fa-solid fa-xmark"></i></button>` :
      selectedPlayers.value == 0 ?
        '' :
        `${selectedPlayers.value}
                <button class="small-reset-button" onclick="resetPlayers()"><i class="fa-solid fa-xmark"></i></button>`;
  rateHint.innerHTML =
    selectedRating.value == 0 ?
      '' :
      `${selectedRating.value}★+
            <button class="small-reset-button" onclick="resetRatings()"><i class="fa-solid fa-xmark"></i></button>`;
  ageHint.innerHTML =
    selectedAge.value == 0 ?
      '' :
      `${selectedAge.value + (selectedAge.value == 18 ? ' and above' : ' and below')}
            <button class="small-reset-button" onclick="resetAge()"><i class="fa-solid fa-xmark"></i></button>`;
  durationHint.innerHTML =
    selectedDuration.value == 0 ?
      '' :
      `${selectedDuration.value == 61 ? '60 mins+' : '~' + selectedDuration.value + " mins"}
            <button class="small-reset-button" onclick="resetDuration()"><i class="fa-solid fa-xmark"></i></button>`;

  const showingAll = (selectedGenre.value == 0) &&
    (selectedRating.value == 0) &&
    (selectedAge.value == 0) &&
    (selectedPlayers.value == 0 || (!playersInput.disabled && (playersInput.value === ''))) &&
    (selectedDuration.value == 0) &&
    (!favouriteButton.checked) &&
    (searchBar.value == '');

  gameCatalog.innerHTML = '';

  filteredGames = games.filter(game => (
    // ((selectedGenres.length === 0) || game.genre.some(g => selectedGenres.includes(g))) &&
    ((selectedGenre.value == 0) || (game.genre.some((g) => g === selectedGenre.value))) &&
    (game.ratings >= selectedRating.value) &&
    ((!favouriteButton.checked) || game.favourite) &&
    ((selectedAge.value == 0) || (selectedAge.value == 18) ?
      (game.age >= selectedAge.value) :
      (game.age <= selectedAge.value
      )) &&
    ((selectedPlayers.value == 0 || (!playersInput.disabled && (playersInput.value === ''))) || ((game.players[0] == game.players[1]) ? (
      (customPlayersInput.checked) ?
        (playersInput.value == game.players[1]) :
        (selectedPlayers.value == game.players[1])
    ) : (
      (customPlayersInput.checked) ?
        (game.players[0] <= playersInput.value && game.players[1] >= playersInput.value) :
        (game.players[0] <= selectedPlayers.value && game.players[1] >= selectedPlayers.value)
    ))) &&
    ((selectedDuration.value == 0) || ((selectedDuration.value == 61) ?
      (game.duration[1] >= 60) :
      (game.duration[0] <= selectedDuration.value && game.duration[1] >= selectedDuration.value)
    )) &&
    ((searchBar.value == '') || game.title.toLowerCase().includes(searchBar.value.toLowerCase()))
  ));

  filteredGames = sortButton.checked ? filteredGames.sort((a, b) => sortOrderButton.checked ? (b.difficulty - a.difficulty) : (a.difficulty - b.difficulty)) : filteredGames;

  listHint.innerText =
    favouriteButton.checked ?
      `Showing Favourites  (${filteredGames.length})` :
      showingAll ?
        `Showing all (${filteredGames.length}) games` :
        filteredGames.length === 0 ?
          `No games found` :
          `Filtered result: Showing ${filteredGames.length} games`;

  filteredGames.forEach(game => {
    const gameCard = createNewGameCard(game);
    gameCard.appendChild(createGameInfoPage(game));
    gameCatalog.appendChild(gameCard);
  });

  updatePageStyles();

  return gameCatalog;
};

function sortOrdering() {
  sortOrderButton.disabled = !sortButton.checked;
  renderGameCatalog();
}

const filters = [durationFilter, rateFilter, ageFilter]
filters.forEach(f => {
  f.forEach(radio => { radio.addEventListener('change', renderGameCatalog); });
});

playersFilter.forEach(radio => {
  radio.addEventListener('change', function () {
    playersInput.disabled = !customPlayersInput.checked;
    if (playersInput.disabled) {
      playersInput.value = '';
      renderGameCatalog();
    }
  });
});

favouriteButton.addEventListener('change', renderGameCatalog);
applyButton.addEventListener('click', renderGameCatalog);
sortButton.addEventListener('change', sortOrdering);
sortOrderButton.addEventListener('change', renderGameCatalog)

const resetGenreButton = document.getElementById('resetGenreButton');
const resetPlayersButton = document.getElementById('resetPlayerButton');
const resetRatingButton = document.getElementById('resetRatingButton');
const resetAgeButton = document.getElementById('resetAgeButton');
const resetDurationButton = document.getElementById('resetDurationButton');

const resetPlayers = function () {
  defaultPlayers = document.getElementById('playersFilter0');
  defaultPlayers.checked = true;
  playersInput.disabled = true;
  playersInput.value = '';
  renderGameCatalog();
}

const resetRatings = function () {
  defaultRatings = document.getElementById('filterRatings0');
  defaultRatings.checked = true;
  renderGameCatalog();
}

const resetGenre = function () {
  defaultGenre = document.getElementById('genreAll');
  defaultGenre.checked = true;
  renderGameCatalog();
}

const resetDuration = function () {
  defaultDuration = document.getElementById('durationFilter0');
  defaultDuration.checked = true;
  renderGameCatalog();
}

const resetAge = function () {
  defaultAge = document.getElementById('ageFilter0');
  defaultAge.checked = true;
  renderGameCatalog();
}

const resetSearch = function () {
  searchBar.value = '';
  renderGameCatalog();
}

// resetGenreButton.addEventListener('click', function() {
//     resetGenre();
//     renderGameCatalog();
// });
// resetRatingButton.addEventListener('click', function() {
//     resetRatings();
//     renderGameCatalog();
// });
// resetPlayersButton.addEventListener('click', function() {
//     resetPlayers();
//     renderGameCatalog();
// });
// resetAgeButton.addEventListener('click', function() {
//     resetAge();
//     renderGameCatalog();
// });
// resetDurationButton.addEventListener('click', function() {
//     resetDuration();
//     renderGameCatalog();
// });

resetButton.addEventListener('click', function () {
  resetPlayers();
  resetRatings();
  resetGenre();
  resetDuration();
  resetAge();
  resetSearch();
});

playersInput.addEventListener('keypress', function (event) {
  if (event.key === 'Enter') { renderGameCatalog(); }
});

searchBar.addEventListener('keypress', function (event) {
  if (event.key === 'Enter') { renderGameCatalog(); }
});
searchButton.addEventListener('click', renderGameCatalog);

function addReview(gameID) {
  // const hintMsg = document.getElementById(`reviewHint${gameID}`);
  const newName = document.getElementById(`name${gameID}`);
  const newReview = document.getElementById(`content${gameID}`);
  const newRating = document.querySelectorAll(`.reviewRadio${gameID}`);
  const selectedRating = Array.from(newRating).find(rateRadio => rateRadio.checked);

  if ((newName.value.length < 1 || newReview.value.length < 1) && selectedRating.value == 0) {
    hintMsg.innerText = 'A reason is needed for 0 stars reviews.';
    setTimeout(() => {
      hintMsg.innerText = '';
    }, 1000);
    return;
  }

  theReview = {
    "madeBy": newName.value,
    "content": newReview.value,
    "rating": parseInt(selectedRating.value)
  }

  

  gameReviews[gameID].push(theReview);

  const gameRev = document.getElementById(`reviews${gameID}`);
  gameRev.appendChild(createReviewCard(theReview));
  newName.value = ''
  newReview.value = ''
  // hintMsg.innerText = 'Added review';
  // setTimeout(() => {
  //   hintMsg.innerText = '';
  // }, 1000);
}

window.addEventListener('resize', function () {
  updatePageStyles();
});


// window.addEventListener('load', function () {
//   updatePageStyles();
// });
resetPlayers();
sortOrdering();
renderGameCatalog();
